<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="../assets/styles/styles-chat.css">
    <link rel="stylesheet" type="text/css" href="../assets/styles/styles.css">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <title>Le general</title>
</head>
<script>
    $.ajax({
        url: '../assets/functions/chat/getUserInfo.php',
        dataType: 'json',
        success: function(data) {
            if (data !== ""){
                document.querySelector('#infoAccount span').innerHTML = data;
            } else {
                localStorage.setItem('login', 'Error: no Session id');
                localStorage.setItem('connection', 'Error: no Session id');
                window.location.href = '/';
            }
        },
    })
</script>
<body>
    <div id="menu">
        <header>
            <div id="selected">
                <span>English</span>
            </div>
            <div>
                <span>French</span>
            </div>
            <div>
                <span>Netherlands</span>
            </div>
        </header> 
        <footer>
            <div>
                <span>Settings</span>
            </div>
            <div class="redSpan">
                <span>Repport</span>
            </div>
            <a href="../assets/functions/chat/disconnection.php">
                <div class="redSpan">
                    <span>Disconnect</span>
                </div>
            </a>
        </footer> 
    </div>
    <div id="chat">
        <div id="chatbox"></div>
        <div id="sendbox">
             <input type="text" id="messageToSend" name="messageToSend" placeholder="Message max 200 characters" onkeypress="pressEnter(event)">
             <img src="../assets/logo/send.svg" onclick="send()">
        </div>
    </div>
    <div id="setting">
        <div id="pannel">
            <p>Settings</p>
            <div class="section">
                <label for="newUsername">Your username : <span id="settingUsername"></span></label>
                <div class="change">
                    <input type="text" name="newUsername" placeholder="New Username">
                    <img src="../assets/logo/save.svg">
                </div>
            </div>
            <div class="section">
                <label for="newUsername">Your E-mail : <span id="settingEmail"></span></label>
                <div class="change">
                    <input type="text" name="newUsername" placeholder="New Username">
                    <img src="../assets/logo/save.svg">
                </div>
            </div>
            <div class="section">
                <label for="newUsername">New password</label>
                <div class="change">
                    <input type="text" name="newUsername" placeholder="New Username">
                    <img src="../assets/logo/save.svg">
                </div>
            </div>
        </div>
        <div id="dark"></div>
    </div>
    <div id="repport">
        <div id="pannel">
            <p>Repport</p>
            <form>
                <input type="text" name="repportUsername" placeholder="Username">
                <select name="cars" id="cars">
                    <option value="volvo">Volvo</option>
                    <option value="saab">Saab</option>
                    <option value="mercedes">Mercedes</option>
                    <option value="audi">Audi</option>
                </select>
            </form>
        </div>
        <div id="dark"></div>
    </div>
    <div id="infoAccount">
        <span></span>
    </div>
</body>


<script type="text/javascript">
    var chat = "english";



    $.ajax({
        url: '../assets/functions/chat/get50.php',
        dataType: 'json',
        type: "POST",
        data: {
            language: "english"
        },
        success: function(response) {
            console.log(response);

            for (var i = 0; i < response.length; ++i) {
                console.log("test");

                var row = response[i];
                var id = row.id;
                var userId = row.userId;
                var message = row.message;
                var time = row.time;
                document.getElementById('chatbox').innerHTML += "<div class='message'><div id='start'><span id='messageUsername'>" + row.username + "</span> : <span id='text'>" + row.message +  "</span></div><div id='end'>" + row.time + "</div></div>";
            }
    const container = document.getElementById("chatbox");
    container.scrollTop = container.scrollHeight;
        }
    })


    function pressEnter(event){
        if (event.keyCode == 13) {
            send();
        }    
    }

    function send() {
        message = document.getElementById("messageToSend").value;
        $.ajax({
            url: "../assets/functions/chat/send.php",
            type: "POST",
            data: {
                message: message,
                language: "english",
            },
        });
        document.getElementById("messageToSend").value = "";
    }


</script>
